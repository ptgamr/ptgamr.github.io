{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-04-08-using-lvm-to-move-ubuntu-to-new-ssd/","result":{"data":{"site":{"siteMetadata":{"title":"Anh Trinh's blog"}},"markdownRemark":{"id":"f38b745e-d5b6-50f6-b251-cd260e018919","excerpt":"Moving old LVM Partition to the new SSD After you have installed the SSD, in my case, it is located at , and let say your current Ubuntu is installed at  Movingâ€¦","html":"<h3>Moving old LVM Partition to the new SSD</h3>\n<p>After you have installed the SSD, in my case, it is located at <code class=\"language-text\">/dev/nvme0n1</code>, and let say your current Ubuntu is installed at <code class=\"language-text\">/dev/sdOLD</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Make it a LVM Physical volume</span>\n<span class=\"token function\">sudo</span> pvcreate /dev/nvme0n1\n\n<span class=\"token comment\"># Verify it</span>\n<span class=\"token function\">sudo</span> lvmdiskscan\n\n<span class=\"token comment\"># My result:</span>\n<span class=\"token comment\">#  /dev/nvme0n1          [     232.89 GiB] LVM physical volume#</span>\n<span class=\"token comment\">#  /dev/ubuntu-vg/root   [      123.31 GiB]</span>\n<span class=\"token comment\">#  .....</span>\n<span class=\"token comment\">#  /dev/sdOLD   [      123.31 GiB] LVM physical volume#</span>\n<span class=\"token comment\">#</span>\n\n<span class=\"token comment\"># Add the new LVM volume to existing ubuntu-vg LVM group</span>\n<span class=\"token function\">sudo</span> vgextend ubuntu-vg /dev/nvme0n1\n\n<span class=\"token comment\"># Moving the old partion to the new</span>\n<span class=\"token function\">sudo</span> pvmove /dev/sdOLD\n\n<span class=\"token comment\"># Removing the old volume from ubunut-vg group</span>\n<span class=\"token function\">sudo</span> vgreduce ubuntu-vg /dev/sdOLD\n\n<span class=\"token comment\"># Remove the physical logical volume (if you wish)</span>\n<span class=\"token function\">sudo</span> pvremove /dev/sdOLD\n\n<span class=\"token comment\"># Updating grub</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">update-grub</span>\n<span class=\"token function\">sudo</span> grub-install /dev/nvme0n1</code></pre></div>\n<h3>Moving your home folder to new SSD</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># create new logical volume on the remaining space</span>\n<span class=\"token function\">sudo</span> lvcreate -l <span class=\"token number\">100</span>%FREE -n home ubuntu-vg\n\n<span class=\"token comment\"># make file system</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkfs</span> -t ext4 /dev/ubuntu-vg/home\n\n<span class=\"token comment\"># mount</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> /dev/ubuntu-vg/home /mnt/home\n\n<span class=\"token comment\"># RSync the home folder</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">rsync</span> -aXS --info<span class=\"token operator\">=</span>progress2 /home/. /mnt/home/.\n\n<span class=\"token comment\"># Backup the current /home</span>\n<span class=\"token builtin class-name\">cd</span> /\n<span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> /home /home_backup\n\n<span class=\"token comment\"># Mount /home to the new location</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> /home\n\n<span class=\"token comment\"># Change fstab</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/fstab\n\n<span class=\"token comment\"># Add following line:</span>\n<span class=\"token assign-left variable\">UUID</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your_partition_uui<span class=\"token operator\">></span>   /home   ext4    nodev,nosuid  <span class=\"token number\">0</span> <span class=\"token number\">2</span>\n\n<span class=\"token comment\"># ( To get the UUID you can use: $ sudo blkid )</span>\n\n<span class=\"token comment\"># Logout and login again to check if it works</span>\n<span class=\"token comment\"># If everything is find, delete the backup folder</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">rm</span> -rf /home_backup\n\n<span class=\"token comment\"># You might shrink your root partition</span>\n<span class=\"token function\">sudo</span> lvresize -L 20G --resizefs /dev/ubuntu-vg/root\n\n<span class=\"token comment\"># To extend /home to take up all the free space</span>\n<span class=\"token function\">sudo</span> lvresize -l +100%FREE --resizefs /dev/ubuntu-vg/home</code></pre></div>\n<h3>References</h3>\n<ul>\n<li>Good introduction about LVM: <a href=\"https://www.digitalocean.com/community/tutorials/how-to-use-lvm-to-manage-storage-devices-on-ubuntu-16-04\">https://www.digitalocean.com/community/tutorials/how-to-use-lvm-to-manage-storage-devices-on-ubuntu-16-04</a></li>\n<li>The original idea is taken from the answer in this thread: <a href=\"https://askubuntu.com/questions/161279/how-do-i-move-my-lvm-250-gb-root-partition-to-a-new-120gb-hard-disk\">https://askubuntu.com/questions/161279/how-do-i-move-my-lvm-250-gb-root-partition-to-a-new-120gb-hard-disk</a></li>\n</ul>","frontmatter":{"title":"Using LVM to move Ubuntu to new SSD","date":"April 08, 2018","description":null}}},"pageContext":{"slug":"/2018-04-08-using-lvm-to-move-ubuntu-to-new-ssd/","previous":{"fields":{"slug":"/2018-04-01-download-coursera-whole-notebook/"},"frontmatter":{"title":"Download whole Coursera notebook"}},"next":{"fields":{"slug":"/2020-04-06-til-bash-double-dash/"},"frontmatter":{"title":"#TIL: Double dash \"--\" option in bash"}}}},"staticQueryHashes":["2841359383","916993862"]}